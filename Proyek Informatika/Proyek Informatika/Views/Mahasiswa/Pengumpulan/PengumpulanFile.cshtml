@using Proyek_Informatika.Models;
<script type = "text/javascript">

    function onComplete(e) {

        if (e.name == "editFile") {
            var values = { idLaporan: e.dataItem.id };
            $.post("Pengumpulan/EditorPengumpulan", values, function (data) {
                var detailWindow = $("#editorUnggah").data("tWindow");

                $("#editorContent").html(data);
                detailWindow.center().open();
            });
        }
        else if (e.name == "unduhFile") {
        alert("test: "+e.dataItem.id);
            var values = { id_laporan: e.dataItem.id };
            window.open("Pengumpulan/GetDownload",values,"_blank");

        }
        else if (e.name == "lihatFile") {
            var values = { id_laporan: e.dataItem.id };
            var id = e.dataItem.id;
            loadIframe("pdfContainer", "Pengumpulan/PDFViewer?id_laporan=" + id);
            var windowZ = $("#viewLaporan").data("tWindow");
            windowZ.center().open();
        }
        else if (e.name == "delFile") {
            var values = { id_laporan: e.dataItem.id };
            var r = confirm("Apakah anda yakin?");
            if (r) {
                $.post("Pengumpulan/DeleteFile", values, function (data) {

                    var val = { file: data, dir: "File Mahasiswa\\@(ViewBag.username)\\dokumen" }
                    $.post("Upload/Remove2", val, function (datas) {
                        if (datas == "") {
                            alert("file berhasil dihapus");
                        }
                        else {
                            alert("file gagal dihapus");
                        }
                        refreshTable();
                    });
                });
            }
        }
        else if (e.name == "unggah") {
            
            var window = $('#formUnggah').data("tWindow");
            window.center().open();
        }
    }
    function closeWindow() {
        var window = $('#formUnggah').data("tWindow");
        var window2 = $('#editorUnggah').data("tWindow");
        window.close();
        window2.close();
    }
    function refreshTable() {
        var table = $(".t-grid .t-refresh").trigger('click');

    }
    function loadIframe(iframeName, url) {
        var $iframe = $('#' + iframeName);
        if ($iframe.length) {
            $iframe.attr('src', url);
            return false;
        }
        return true;
    }
    $('#btnFormUnggah').click(function () {
        var window = $('#formUnggah').data("tWindow");
        window.center().open();
    });
    
</script>
<div class="layer">
    <h1>Berkas-berkas Skripsi</h1>
    @(  Html.Telerik().Window()
        .Name("formUnggah")
        .Title("Upload File")
        .LoadContentFrom("FormPengumpulan","Pengumpulan")
            .Width(500)
            .Height(350)
            .Draggable(true)
            .Modal(true)
            .Visible(false)
)
 @(  Html.Telerik().Window()
        .Name("editorUnggah")
        .Title("Edit File")
        .Content(@<text><div id= "editorContent"></div></text>)
            .Width(500)
            .Height(350)
            .Draggable(true)
            .Modal(true)
            .Visible(false)
)
     @*<input type ="button" id="btnFormUnggah" value = "Unggah" />
      <br/><br/>*@

@(
 Html.Telerik().Grid<laporan>().HtmlAttributes(new { style = "width:100%" })
 .Name("TableFileMahasiswa")
.Columns(
    col =>
    {
        col.Bound(o => o.jenis).Title("Nama File").Width(245);
        col.Bound(o => o.tanggal_pengumpulan).Title("Tanggal Pengumpulan").Width(175);
        col.Command(com =>
        {
            com.Custom("unduhFile").Text("Download").Ajax(true);
            com.Custom("lihatFile").Text("View").Ajax(true);
            com.Custom("editFile").Text("Edit").Ajax(true);
            com.Custom("delFile").Text("Delete").Ajax(true);
        }).Width(320);
    }
)
.DetailView(det => det.ClientTemplate(
         "<fieldset>" +
             "<legend>Detil Bahasan</legend>" +
                 "<div class = 'deskripsi'><#= deskripsi #>" +
                 "</div>" +
         "</fieldset>"
    ))
.ClientEvents(events => events.OnCommand("onComplete"))
.DataBinding(data => data.Ajax().Select("SelectPengumpulan", "Pengumpulan"))
.ToolBar(t=>t.Custom().Name("unggah").Text("Upload").Ajax(true))
.Sortable()
.Filterable()
.Scrollable(c => c.Enabled(true))
.Selectable()
.Groupable()
)


@(Html.Telerik().Window()
                .Name("viewLaporan")
                .Visible(false)
                .Title("View File")
                .Modal(true)
                .Width(800)
                .Height(500)
                .Scrollable(true)
                .Content(@<text><iframe src="" id="pdfContainer" style="width:100%; height:100%; border:none;"></iframe></text>))





</div>